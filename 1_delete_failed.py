"""
删除不能编译的合约源码
"""

import os
import re

result=[]
normal_contract=[]
delete_contract=[]
with open('log.txt','r',encoding='utf-8') as f:
    for line in f:
        #Python中split()就是将一个字符串分裂成多个字符串，并以列表的形式返回。
        result.append(list(line.strip('\n').split(',')))
    for i in range(len(result)):
        # print(result[i])
        text = result[i][0]
        if str(result[i][0]).isdigit():
            continue
        else:
            matchObj = re.match(r'^CRITICAL',text)
            if matchObj:
                # print(text)
                # print(result[i-3])
                t=re.findall(r'./sol_149363/(.*).sol',str(result[i-3]))
                # print(t)
                delete_contract.append(t[0]+".sol")
                continue
    # print(delete_contract)

    path = './data'
    datanames = os.listdir(path)
    for j in datanames:
        # print(j)
        for k in range(len(delete_contract)):
            # print(delete_contract[k])
            if j == delete_contract[k]:
                # print(j)
                del_file=path+'/'+j
                os.remove(del_file)
                print("已经删除：",del_file)




