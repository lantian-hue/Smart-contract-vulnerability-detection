from collections import Counter
import csv


OPC = [
    'STOP',
    'ARITHMETIC_OP',
    # 'ADD',
    # 'MUL',
    # 'SUB',
    # 'DIV',
    # 'SDIV',
    # 'MOD',
    # 'SMOD',
    # 'ADDMOD',
    # 'MULMOD',
    # 'EXP',
    'SIGNEXTEND',
    'COMPARISON',
    # 'LT',
    # 'GT',
    # 'SLT',
    #  'SGT',
     'EQ',
     'ISZERO',
    'LOGIC_OP',
    #  'AND',
    #  'OR',
    #  'XOR',
    # 'NOT',
     'BYTE',
    'SHL',
     'SHR',
    'SAR',
     'SHA3',
    'CONSTANT2'
    # 'ADDRESS',
    'BALANCE',
     # 'ORIGIN',
    # 'CALLER',
     'CALLVALUE',
     'CALLDATALOAD',
     'CALLDATASIZE',
     'CALLDATACOPY',
     'CODESIZE',
    'CODECOPY',
     'GASPRICE',
    'EXTCODESIZE',
    'EXTCODECOPY',
    'RETURNDATASIZE',
    'RETURNDATACOPY',
  'EXTCODEHASH',
    'CONSTANT1',
     # 'BLOCKHASH',
     # 'COINBASE',
   # 'TIMESTAMP',
   #  'NUMBER',
   #   'DIFFICULTY',
   #  'GASLIMIT',
    'POP',
    'MLOAD',
    'MSTORE',
    'MSTORE8',
     'SLOAD',
    'SSTORE',
   'JUMP',
     'JUMPI',
    'PC',
     'MSIZE',
   'GAS',
     'JUMPDEST',
    'DUP',
    'SWAP',
    'PUSH',
    'LOG',
  #   'PUSH1',
  #   'PUSH2',
  #  'PUSH3',
  #   'PUSH4',
  #   'PUSH5',
  #   'PUSH6',
  #   'PUSH7',
  #    'PUSH8',
  #    'PUSH9',
  #    'PUSH10',
  #    'PUSH11',
  #    'PUSH12',
  #   'PUSH13',
  #    'PUSH14',
  #    'PUSH15',
  #    'PUSH16',
  #    'PUSH17',
  #   'PUSH18',
  #    'PUSH19',
  #    'PUSH20',
  #    'PUSH21',
  #    'PUSH22',
  #    'PUSH23',
  #    'PUSH24',
  #    'PUSH25',
  #    'PUSH26',
  #    'PUSH27',
  #    'PUSH28',
  #    'PUSH29',
  #   'PUSH30',
  #   'PUSH31',
  #    'PUSH32',
  #    'DUP1',
  #    'DUP2',
  #    'DUP3',
  #   'DUP4',
  #   'DUP5',
  #    'DUP6',
  #    'DUP7',
  #    'DUP8',
  #    'DUP9',
  #    'DUP10',
  #    'DUP11',
  #    'DUP12',
  #    'DUP13',
  #    'DUP14',
  #    'DUP15',
  #    'DUP16',
  #    'SWAP1',
  #    'SWAP2',
  #    'SWAP3',
  #    'SWAP4',
  #    'SWAP5',
  #    'SWAP6',
  #    'SWAP7',
  #    'SWAP8',
  #   'SWAP9',
  #    'SWAP10',
  #    'SWAP11',
  #    'SWAP12',
  #    'SWAP13',
  #    'SWAP14',
  #    'SWAP15',
  #    'SWAP16',
  #    'LOG0',
  #    'LOG1',
  #    'LOG2',
  #    'LOG3',
  #    'LOG4',
     'CREATE',
     'CALL',
     'CALLCODE',
     'RETURN',
     'DELEGATECALL',
     'CREATE2',
    'STATICCALL',
     'REVERT',
     'INVALID',
     'SELFDESTRUCT']


with open('monitor1.csv','r') as csvinput:
    with open('opcode_counter.csv', 'w') as csvoutput:
        writer = csv.writer(csvoutput)
        reader = csv.reader(csvinput)

        row = next(reader)
        row.append('fr_opcode')
        row.append('opc_split')

        writer.writerow(row)

        for row in reader:
          data_set=row[1]
          split_it = data_set.split()
          count = Counter(split_it)
          row.append(Counter({key: count[key] for key in count if key in OPC}).most_common(10))
          row.append(split_it)
          writer.writerow(row)